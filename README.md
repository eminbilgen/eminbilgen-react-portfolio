This code is pretty dirty. I do not recommend to use. 
I will clean up in future.
